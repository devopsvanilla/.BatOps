# Para implantar a stack após a execução do script:
# 1. Exporte as variáveis de ambiente necessárias (senha e porta):
#
#    export PASS_MYSQL=$(sudo sed -n 's/.*"root_password" *: *"\([^"]*\)".*/\1/p' /etc/morpheus/morpheus-secrets.json)
#    export PMA_PORT=<porta_usada>
#
#    Substitua <porta_usada> pela porta configurada no script, ex: 83306
#
# 2. Execute o Docker Compose para iniciar a stack:
#    docker compose up -d
#
# Para parar a stack:
#    docker compose down
#
# Para ver logs:
#    docker compose logs -f
#
# Para reiniciar a stack:
#    docker compose restart
#
# Para verificar status:
#    docker compose ps
#
# IMPORTANTE: As variáveis de ambiente PASS_MYSQL e PMA_PORT devem estar
# definidas antes de executar qualquer comando docker compose.

version: '3.8'

services:
  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    container_name: morpheus-phpmyadmin
    restart: unless-stopped
    ports:
      - "${PMA_PORT}:8306"
    environment:
      PMA_HOST: host.docker.internal
      PMA_PORT: 3306
      PMA_USER: morpheus
      PMA_PASSWORD: "${PASS_MYSQL}"
      UPLOAD_LIMIT: 256M
      PMA_ABSOLUTE_URI: "http://localhost:${PMA_PORT}/"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - phpmyadmin_sessions:/sessions

volumes:
  phpmyadmin_sessions:
