# Para implantar a stack manualmente após a execução do script:
# 1. Exporte as variáveis de ambiente necessárias:
#
#    export PASS_MYSQL=$(sudo sed -n 's/.*"root_password" *: *"\([^"]*\)".*/\1/p' /etc/morpheus/morpheus-secrets.json)
#    export PMA_PORT=<porta_phpmyadmin>
#    export PMA_USER=<usuario_mysql>
#    export MYSQL_PORT=<porta_mysql>
#    export HOST_IP=<ip_do_host>
#
#    Exemplo:
#    export PASS_MYSQL=f728d412b85ec6c3321463eb
#    export PMA_PORT=8306
#    export PMA_USER=root
#    export MYSQL_PORT=3306
#    export HOST_IP=192.168.0.30
#
# 2. Execute o Docker Compose para iniciar a stack:
#
#    docker compose up -d
#
# Para parar a stack:
#
#    docker compose down
#
# Para ver logs:
#
#    docker compose logs -f
#
# Para reiniciar a stack:
#
#    docker compose restart
#
# Para verificar status:
#
#    docker compose ps
#
# IMPORTANTE: 
# - As variáveis de ambiente PASS_MYSQL, PMA_PORT, PMA_USER, MYSQL_PORT 
#   e HOST_IP devem estar definidas antes de executar qualquer comando docker compose.
# - O MySQL embedded do Morpheus deve estar configurado para aceitar conexões externas
# - Usuários MySQL devem ter permissões para conectar do IP externo

version: '3.8'

services:
  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    container_name: morpheus-phpmyadmin
    restart: unless-stopped
    ports:
      - "${PMA_PORT}:80"
    environment:
      PMA_HOST: "${HOST_IP}"
      PMA_PORT: "${MYSQL_PORT}"
      PMA_USER: "${PMA_USER}"
      PMA_PASSWORD: "${PASS_MYSQL}"
      UPLOAD_LIMIT: 256M
      PMA_ABSOLUTE_URI: "http://${HOST_IP}:${PMA_PORT}/"
    volumes:
      - phpmyadmin_sessions:/sessions

volumes:
  phpmyadmin_sessions:
